-- source include/have_debug.inc

SET sql_mode=ORACLE;


# TODO: instructions "package_variable:=expr" do not get printed well
# in "SHOW PROCEDURE CODE pkg.p" and "SHOW FUNCTION CODE pkg.f".


DELIMITER $$;
CREATE PACKAGE pkg1 AS
  PROCEDURE p1;
  FUNCTION f1 RETURN INT;
  PROCEDURE p2show;
  PROCEDURE p2public;
  FUNCTION f2public RETURN TEXT;
END;
$$
CREATE PACKAGE BODY pkg1 AS
  a INT:=10;
  PROCEDURE p1 AS
    b INT:=20;
  BEGIN
    b:=a;
    b:=a+1;
    a:=b;
    a:=b+1;
    a:=a+1;
    SET @a:=@a+2;
    SELECT f1() FROM DUAL;
  END;
  FUNCTION f1 RETURN INT AS
  BEGIN
    RETURN a;
  END;
  PROCEDURE p2private AS
  BEGIN
    SELECT 'This is p2private';
  END;
  PROCEDURE p2public AS
  BEGIN
    SELECT 'This is p2public';
  END;
  FUNCTION f2private RETURN TEXT AS
  BEGIN
    RETURN 'This is f2private';
  END;
  FUNCTION f2public RETURN TEXT AS
  BEGIN
    RETURN 'This is f2public';
  END;
  PROCEDURE p2show AS
  BEGIN
    SHOW FUNCTION CODE f2public;
    SHOW FUNCTION CODE f2private;
    SHOW PROCEDURE CODE p2public;
    SHOW PROCEDURE CODE p2private;
    SHOW PROCEDURE CODE p2show;
  END;
BEGIN
  a:=a+1;
  DECLARE
    b INT;
  BEGIN
    b:=a;
    b:=a+1;
    a:=b;
    a:=b+1;
  END;
END;
$$
DELIMITER ;$$

SHOW PROCEDURE CODE pkg1.p1;
SHOW FUNCTION CODE pkg1.f1;
SHOW PACKAGE BODY CODE pkg1;
CALL pkg1.p2show;

DROP PACKAGE pkg1;
